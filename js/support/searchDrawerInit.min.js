jQuery(document).ready(function(a){function b(){a(".drawer").drawer("toggle"),a(".search-results").toggleClass("opened"),a(".drawer").removeClass("filters-active"),i&&a(".drawer").addClass("filters-active")}function c(b){var c=(b.parent().hasClass("lone-parent"),b.hasClass("parent-category")),d=b.parents(".drawer-dropdown"),e=d.hasClass("active"),f=b.parent().siblings(),g=f.hasClass("active");i=!1,c||(e||g||(d.addClass("active"),i=!0),e&&!g&&(d.removeClass("active"),a(".drawer").removeClass("filters-active"),i=!1))}function d(){var b=[],c=[];a(".category-menu .cat-item").filter(".active").each(function(){b.push(a(this).children(".filter-item").data("cat_id"))}),a(".issue-menu .issue-filter").parent().filter(".active").not(".parent-category").each(function(){c.push(a(this).children(".issue-filter").data("issue"))});var d=a(".columns-search-input-field").val(),f=e.clone().deleteQueryParam("cat").deleteQueryParam("issue").deleteQueryParam("searchpage").deleteQueryParam("search");b.length>0&&f.replaceQueryParam("cat",b.join(",")),c.length>0&&f.replaceQueryParam("issue",c.join(",")),d.length>0&&f.replaceQueryParam("search",d),location.replace(f.toString())}a(".issue-row").flickity({cellSelector:".carousel-cell",cellAlign:"left",pageDots:!1,contain:!0,setGallerySize:!1,dragThreshold:10}),a(".drawer").drawer({class:{nav:"search-drawer-scroller",overlay:"drawer-overlay",open:"drawer-open",close:"drawer-close",dropdown:"dropdown-toggle"},iscroll:{mouseWheel:!1,preventDefault:!0},showOverlay:!1}),a(window).on("resize",function(){a(".drawer").drawer("close"),a(".search-results").removeClass("opened")}),a("#filterToggle").on("click",_.debounce(b,700,!0));var e=new Uri(location),f=e.getQueryParamValue("cat"),g=e.getQueryParamValue("issue"),h=e.getQueryParamValue("order"),i=(e.getQueryParamValue("search"),!1);if(void 0!==f){var j=f.split(",");j.forEach(function(b){a(".search-container").find("[data-cat_id="+b+"]").addClass("active"),a(".category-menu").find("[data-cat_id="+b+"]").parents(".cat-item").addClass("active"),c(a(".category-menu").find("[data-cat_id="+b+"]"))})}if(void 0!==g){var j=g.split(",");j.forEach(function(b){a(".search-container").find("[data-issue="+b+"]").toggleClass("active"),a(".issue-menu").find("[data-issue="+b+"]").parent().addClass("active"),c(a(".issue-menu").find("[data-issue="+b+"]"))})}if(a(".current-filter-wrapper>.filter-item").click(function(b){var d=a(".drawer-menu").find("[data-cat_id="+a(this).data("cat_id")+"]"),e=a(".drawer-menu").find("[data-issue="+a(this).data("issue")+"]");d.parent().removeClass("active"),e.parent().removeClass("active"),a(this).removeClass("active"),c(d),c(e)}),void 0!==h)switch(h){case"asc":a(".order-oldest span").addClass("current");break;case"desc":a(".order-newest span").addClass("current")}a(".drawer-menu .filter-item").not(".parent-category").click(function(b){b.stopPropagation(),a(this).parent().toggleClass("active"),a(".search-container").find("[data-cat_id="+a(this).data("cat_id")+"]").not(a(this)).toggleClass("active"),a(".search-container").find("[data-issue="+a(this).data("issue")+"]").not(a(this)).toggleClass("active"),c(a(this))}),a(".columns-search-input-submit").click(function(b){d(a(this))}),a(".columns-search-form").submit(function(a){a.preventDefault(),d()}),a(".search-filter-item.active").click(function(b){a(".columns-search-input-field").val(""),e.replaceQueryParam("search","")}),a(".columns-search-input-field").on("keyup",_.debounce(function(b){switch(b.currentTarget.value){case"":a(".search-filter-item").html(b.currentTarget.value).removeClass("active");break;default:a(".columns-search-input-field").not(a(this).each(function(){a(".columns-search-input-field").val(b.currentTarget.value),a(".search-filter-item").html(b.currentTarget.value).addClass("active")}))}},50))});