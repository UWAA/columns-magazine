jQuery(document).ready(function(a){function b(){a(".drawer").drawer("toggle"),a(".search-results").toggleClass("opened"),console.log(a("#filterToggle").html())}function c(a){var b=(a.parent().hasClass("lone-parent"),a.hasClass("parent-category")),c=a.parents(".drawer-dropdown"),d=c.hasClass("active"),e=a.parent().siblings(),f=e.hasClass("active");b||(d||f||c.addClass("active"),d&&!f&&c.removeClass("active"))}a(".issue-row").flickity({cellSelector:".carousel-cell",cellAlign:"left",pageDots:!1,contain:!0,setGallerySize:!1,dragThreshold:10}),a(".drawer").drawer({class:{nav:"drawer-nav",overlay:"drawer-overlay",open:"drawer-open",close:"drawer-close",dropdown:"dropdown-toggle"},iscroll:{mouseWheel:!0,preventDefault:!1},showOverlay:!0}),a("#filterToggle").on("click",_.debounce(b,700,!0));var d=new Uri(location),e=d.getQueryParamValue("cat"),f=d.getQueryParamValue("issue"),g=d.getQueryParamValue("order");if(void 0!==e){var h=e.split(",");h.forEach(function(b){a(".search-container").find("[data-cat_id="+b+"]").addClass("active"),a(".category-menu").find("[data-cat_id="+b+"]").parent().addClass("active"),c(a(".category-menu").find("[data-cat_id="+b+"]"))})}if(void 0!==f){var h=f.split(",");h.forEach(function(b){a(".search-container").find("[data-issue="+b+"]").toggleClass("active"),a(".issue-menu").find("[data-issue="+b+"]").parent().addClass("active"),c(a(".issue-menu").find("[data-issue="+b+"]"))})}if(a(".current-filter-wrapper>.filter-item").click(function(b){console.log(a(this).data("cat_id"));var d=a(".drawer-menu").find("[data-cat_id="+a(this).data("cat_id")+"]");d.parent().removeClass("active"),a(this).removeClass("active"),c(d)}),void 0!==g)switch(g){case"asc":a(".order-oldest span").addClass("current");break;case"desc":a(".order-newest span").addClass("current")}a(".drawer-menu .filter-item").click(function(b){b.stopPropagation(),a(this).parent().toggleClass("active"),c(a(this)),a(".search-container").find("[data-cat_id="+a(this).data("cat_id")+"]").not(a(this)).toggleClass("active"),a(".search-container").find("[data-issue="+a(this).data("issue")+"]").not(a(this)).toggleClass("active")}),a(".columns-search-input-submit").click(function(b){var c=[],e=[];a(".category-menu .cat-item").filter(".active").each(function(){c.push(a(this).children(".filter-item").data("cat_id"))}),a(".issue-menu .issue-filter").parent().filter(".active").not(".parent-category").each(function(){e.push(a(this).children(".issue-filter").data("issue"))});var f=a(".columns-search-input-field").val(),g=d.clone().setPath("/search").deleteQueryParam("cat").deleteQueryParam("issue");c.length>0&&g.replaceQueryParam("cat",c.join(",")),e.length>0&&g.replaceQueryParam("issue",e.join(",")),f&&g.replaceQueryParam("search",f),location.replace(g.toString())}),a(".search-filter-item.active").click(function(b){a(".columns-search-input-field").val(""),d.replaceQueryParam("search","")}),a(".columns-search-input-field").on("keyup",_.debounce(function(b){switch(console.log("updating search"),b.currentTarget.value){case"":a(".search-filter-item").html(b.currentTarget.value).removeClass("active");break;default:a(".columns-search-input-field").not(a(this).each(function(){a(".columns-search-input-field").val(b.currentTarget.value),a(".search-filter-item").html(b.currentTarget.value).addClass("active")}))}},500))});